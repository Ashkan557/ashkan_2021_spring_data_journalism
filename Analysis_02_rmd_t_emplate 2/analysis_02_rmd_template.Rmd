---
title: "Data Analysis 02 Template"
author: "Ashkan Motamedi,Joshua Davidsburg, Brittany Gaddy, Julia Arbutus"
date: "4/18/2021"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
## Load libraries
```{r cars}
library(tidyverse)
library(dplyr)
library(janitor)
# Load Tidycensus after installing if necessary
#install.packages('tidycensus')
library(tidycensus)
# Load censusxy for geocoding
library(censusxy)
census_api_key("549950d36c22ff16455fe196bbbd01d63cfbe6cf")
```

```{r}
# Load required data
# Path to data should be loaded from folder "data" i.e. tabula_SalesAndRedeemsByMonth <- read_csv("data/tabula_SalesAndRedeemsByMonth.csv")
tabula_SalesAndRedeemsByMonth
```

```{r}
# Clean required data and prepare for analysis if needed. 
Clean_tabula_SalesAndRedeemsByMonth <-  read_csv("tabula-SalesAndRedeemsByMonth.csv") %>%
clean_names()
  Clean_tabula_SalesAndRedeemsByMonth
  
  
 x <- Clean_tabula_SalesAndRedeemsByMonth %>%
   group_by(zip_code)%>%
   count()
```


```{r}
Clean_tabula_SalesAndRedeemsByMonth <-  read_csv("tabula-SalesAndRedeemsByMonth.csv") %>%
clean_names()
  Clean_tabula_SalesAndRedeemsByMonth
  
  
 number_of_stores_per_zip <- Clean_tabula_SalesAndRedeemsByMonth %>%
   group_by(zip_code)%>%
   count()
 ## Get list of states (Exclude non-states, except DC)
states <- fips_codes %>%
  select(state) %>%
  distinct() %>%
  filter(state == "KY") %>%
  head(51) %>%
  as_vector() 


#get Zip census information
zcta_stats <- get_acs(geography = "zcta", variables = c( "B01001_001","B02001_002","B02001_003","B02001_004","B03001_003","B06012_002","B19013_001"), year = 2018) %>%
  select(GEOID, NAME, variable, estimate) %>%
  pivot_wider(names_from=variable, values_from=estimate) %>%
  rename(
    total_pop = B01001_001,
    white_pop = B02001_002,
    black_pop = B02001_003,
    native_pop = B02001_004,
    hispanic_pop = B03001_003,
    poverty_pop = B06012_002,
    median_income = B19013_001
  ) %>%
  mutate(pct_white = round(white_pop/total_pop,2)*100,
         pct_nonwhite = 100-round(white_pop/total_pop,2)*100,
         pct_black = round(black_pop/total_pop,2)*100,
         pct_native = round(native_pop/total_pop,2)*100,
         pct_hispanic = round(hispanic_pop/total_pop,2)*100,
         pct_poverty = round(poverty_pop/total_pop,2)*100
         ) %>%
  clean_names() %>%
  mutate(fips_code_state = str_sub(geoid,start=1L,end=2L),
         geoid=str_sub(geoid, start=3L,end=7L)) %>%
  select(fips_code_state, name, geoid,-ends_with("pop"), starts_with("pct"),median_income) %>%
  mutate(name = as.numeric(substr(name, 7,11))) 

#join number of stores per zip with census data

number_of_stores_joined_with_census <- number_of_stores_per_zip %>%
  left_join(zcta_stats, by = c("zip_code" = "name"))

number_of_stores_joined_with_census

```

```

-30-