---
title: "Data Analysis 01 Template"
author: "Student names here"
date: "3/2/2021"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
## Load libraries
```{r cars}
library(tidyverse)
library(dplyr)
library(janitor)
# Load Tidycensus after installing if necessary
#install.packages('tidycensus')
library(tidycensus)
# Load censusxy for geocoding
library(censusxy)
census_api_key("549950d36c22ff16455fe196bbbd01d63cfbe6cf")
```

```{r echo=FALSE, message=FALSE}

```

## Load and Cleaning Data

[In this block of text, describe the source of the data, and write a basic data dictionary for data you are working with]

```{r}
# Load required data
# Path to data should be loaded from folder "data" i.e. tabula_SalesAndRedeemsByMonth <- read_csv("data/tabula_SalesAndRedeemsByMonth.csv")
tabula_SalesAndRedeemsByMonth
```

```{r}
# Clean required data and prepare for analysis if needed. 
Clean_tabula_SalesAndRedeemsByMonth <-  read_csv("tabula-SalesAndRedeemsByMonth.csv") %>%
clean_names()
  Clean_tabula_SalesAndRedeemsByMonth
  
  
 x <- Clean_tabula_SalesAndRedeemsByMonth %>%
   group_by(zip_code)%>%
   count()
```

## Sentences to Engineer
In this notebook, we are reverse engineering five sentences from the story.

### Sentence 1

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 2

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 3

* **Sentence text**: [Have any of the sales trends we've identified changed over the last few years, especially when comparing trends before and during the pandemic? ]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
Clean_tabula_SalesAndRedeemsByMonth <-  read_csv("tabula-SalesAndRedeemsByMonth.csv") %>%
clean_names()
  Clean_tabula_SalesAndRedeemsByMonth
  
  
 x <- Clean_tabula_SalesAndRedeemsByMonth %>%
   group_by(zip_code)%>%
   count()
 ## Get list of states (Exclude non-states, except DC)
states <- fips_codes %>%
  select(state) %>%
  distinct() %>%
  filter(state == "KY") %>%
  head(51) %>%
  as_vector() 

zcta_stats <- get_acs(geography = "zcta", variables = c( "B01001_001","B02001_002","B02001_003","B02001_004","B03001_003","B06012_002","B19013_001"), year = 2018) %>%
  select(GEOID,NAME, variable, estimate) %>%
  pivot_wider(names_from=variable, values_from=estimate) %>%
  rename(
    total_pop = B01001_001,
    white_pop = B02001_002,
    black_pop = B02001_003,
    native_pop = B02001_004,
    hispanic_pop = B03001_003,
    poverty_pop = B06012_002,
    median_income = B19013_001
  ) %>%
  mutate(pct_white = round(white_pop/total_pop,2)*100,
         pct_nonwhite = 100-round(white_pop/total_pop,2)*100,
         pct_black = round(black_pop/total_pop,2)*100,
         pct_native = round(native_pop/total_pop,2)*100,
         pct_hispanic = round(hispanic_pop/total_pop,2)*100,
         pct_poverty = round(poverty_pop/total_pop,2)*100
         ) %>%
  clean_names() %>%
  mutate(fips_code_state = str_sub(geoid,start=1L,end=2L),
         geoid=str_sub(geoid, start=3L,end=7L)) %>%
  select(fips_code_state,geoid,-ends_with("pop"), starts_with("pct"),median_income) 
 census_tract_stats <- get_acs(geography = "tract", variables = c( "B01001_001","B02001_002","B02001_003","B02001_004","B03001_003","B06012_002","B19013_001"), state=states,year = 2018) %>%
  select(GEOID, variable, estimate) %>%
  pivot_wider(names_from=variable, values_from=estimate) %>%
  rename(
    total_pop = B01001_001,
    white_pop = B02001_002,
    black_pop = B02001_003,
    native_pop = B02001_004,
    hispanic_pop = B03001_003,
    poverty_pop = B06012_002,
    median_income = B19013_001
  ) %>%
  mutate(pct_white = round(white_pop/total_pop,2)*100,
         pct_nonwhite = 100-round(white_pop/total_pop,2)*100,
         pct_black = round(black_pop/total_pop,2)*100,
         pct_native = round(native_pop/total_pop,2)*100,
         pct_hispanic = round(hispanic_pop/total_pop,2)*100,
         pct_poverty = round(poverty_pop/total_pop,2)*100
         ) %>%
  clean_names() %>%
  select(geoid,-ends_with("pop"), starts_with("pct"),median_income) 
#left_join(census_tract_stats, by = "x") 
# Produce geocoded dataframe
geocoded_Kentucky <- cxy_geocode(x , street = 'address', city = 'city', state = 'state', zip = 'zip code',return='geographies',benchmark='Public_AR_Current',vintage='Current_Current',output='full') %>%
  mutate(geoid=paste0(cxy_state_id,cxy_county_id,cxy_tract_id)) %>%
  select(geoid, everything())
	
geocoded_sample
# Display results of code below this codeblock

```

### Sentence 4

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 5

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

-30-